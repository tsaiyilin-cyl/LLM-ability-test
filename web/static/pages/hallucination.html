<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大模型幻觉测试 - LLM 能力测试平台</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>💭 大模型幻觉测试</h1>
            <p>测试模型的幻觉发生率和事实核查能力</p>
            <a href="/static/index.html" class="back-link">← 返回首页</a>
        </header>

        <!-- API 配置 -->
        <section class="card">
            <div class="collapsible-header" onclick="toggleSection('configBody')">
                <h3>⚙️ API 配置</h3>
                <span class="toggle-icon" id="configIcon">▼</span>
            </div>
            <div class="collapsible-body" id="configBody">
                <div class="form-grid">
                    <div class="form-field">
                        <label>API Base URL</label>
                        <input type="text" id="apiBaseUrl" placeholder="https://api.openai.com">
                    </div>
                    <div class="form-field">
                        <label>API Key</label>
                        <div class="input-with-toggle">
                            <input type="password" id="apiKey" placeholder="sk-xxxxxxxx">
                            <button class="toggle-visibility" onclick="toggleKeyVisibility()">👁️</button>
                        </div>
                    </div>
                </div>
                <div class="btn-group mt-2">
                    <button class="btn btn-primary btn-sm" onclick="App.saveApiConfig()">💾 保存</button>
                    <button class="btn btn-secondary btn-sm" onclick="App.testConnection()">🔗 测试连接</button>
                    <button class="btn btn-secondary btn-sm" id="fetchModelsBtn" onclick="App.fetchModelsFromAPI()">🔄 获取模型列表</button>
                </div>
                <div class="status info mt-1" id="apiStatus">⚪ 点击测试连接</div>
            </div>
        </section>

        <!-- 控制面板 -->
        <div class="form-grid">
            <div class="card">
                <div class="collapsible-header" onclick="toggleSection('modelBody')">
                    <div>
                        <h3>🤖 选择模型</h3>
                        <span class="model-display" id="modelDisplay">未选择</span>
                    </div>
                    <span class="toggle-icon" id="modelIcon">▼</span>
                </div>
                <div class="collapsible-body open" id="modelBody">
                    <div class="model-selector">
                        <input type="text" id="modelSearchInput" class="model-search-input" placeholder="🔍 搜索模型...">
                        <select id="modelSelect" size="8" class="model-select">
                            <!-- 模型列表将通过 JavaScript 动态加载 -->
                        </select>
                        <span class="hint">
                            请在 API 配置中点击"获取模型列表"按钮获取模型，然后在搜索框中输入关键词快速查找
                        </span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="mb-1">测试语言</h3>
                <select id="langSelect">
                    <option value="zh">中文</option>
                    <option value="en">English</option>
                    <option value="all">🌐 中英全选</option>
                </select>
            </div>

            <div class="card">
                <h3 class="mb-1">执行测试</h3>
                <button class="btn btn-primary btn-block" id="runTestBtn" onclick="App.runTests()">
                    🚀 运行选中测试
                </button>
                <div class="checkbox-wrapper mt-1">
                    <input type="checkbox" id="selectAll" onchange="App.toggleSelectAll()">
                    <label for="selectAll" style="color: var(--text-secondary); font-size: 0.875rem;">全选所有用例</label>
                </div>
                <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem; padding: 0.5rem; background: var(--bg-hover); border-radius: 4px;">
                    💡 如发现幻觉，可在结果卡片中点击"质疑测试"按钮测试自我纠正能力
                </div>
            </div>
        </div>

        <!-- 提示词配置 -->
        <section class="card">
            <div class="collapsible-header" onclick="toggleSection('promptBody')">
                <h3>📝 提示词配置</h3>
                <span class="toggle-icon" id="promptIcon">▼</span>
            </div>
            <div class="collapsible-body open" id="promptBody">
                <div class="form-grid">
                    <div class="form-field">
                        <label>System Prompt <span style="font-size: 0.7rem; color: var(--accent-primary);">(系统提示词)</span></label>
                        <textarea id="sysPrompt" placeholder="输入系统提示词..."></textarea>
                        <span class="hint">定义 AI 助手的角色和行为</span>
                    </div>
                    <div class="form-field">
                        <label>User Prompt <span style="font-size: 0.7rem; color: var(--accent-primary);">(用户提示词模板)</span></label>
                        <textarea id="userPrompt" placeholder="输入用户提示词模板..."></textarea>
                        <span class="hint">使用 <code>{question}</code> 作为问题占位符</span>
                    </div>
                </div>
                <div class="btn-group mt-2">
                    <button class="btn btn-secondary btn-sm" onclick="App.resetPrompts()">🔄 重置为默认</button>
                    <button class="btn btn-secondary btn-sm" onclick="App.savePrompts()">💾 保存提示词</button>
                </div>
            </div>
        </section>

        <!-- 测试说明 -->
        <section class="card">
            <h3 class="mb-1">💡 测试说明</h3>
            <div style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6;">
                <p><strong>幻觉类型说明：</strong></p>
                <ul style="padding-left: 1.5rem; margin-top: 0.5rem;">
                    <li><span class="badge badge-critical">虚假事实</span> 测试模型是否会编造不存在的事实</li>
                    <li><span class="badge badge-high">未来预测</span> 测试模型是否会声称知道未来事件</li>
                    <li><span class="badge badge-medium">反常识</span> 测试模型对反常识问题的识别能力</li>
                    <li><span class="badge badge-low">边界测试</span> 测试模型对边界情况的处理</li>
                </ul>
            </div>
        </section>

        <!-- 测试用例 -->
        <section class="card">
            <div class="card-header">
                <h3 class="mb-0">📋 幻觉测试用例</h3>
                <button class="btn btn-secondary btn-sm" onclick="App.clearAllData()">🗑️ 清除历史数据</button>
            </div>
            <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">
                测试模型是否会产生幻觉，包括编造事实、错误预测、虚假引用等
            </p>
            <div class="test-grid" id="testCasesGrid">
                <!-- 测试用例将在这里加载 -->
            </div>
        </section>

        <!-- 测试结果 -->
        <section class="card hidden" id="resultsSection">
            <div class="card-header">
                <h3>📊 测试结果</h3>
                <div class="btn-group">
                    <button class="btn btn-primary btn-sm" onclick="Components.generateHallucinationReport()">📋 生成评估报告</button>
                    <button class="btn btn-secondary btn-sm" onclick="App.clearResults()">清空结果</button>
                </div>
            </div>
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="totalTests">0</div>
                    <div class="stat-label">总测试数</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="passedCount">0</div>
                    <div class="stat-label">无幻觉</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="avgTime">0s</div>
                    <div class="stat-label">平均响应</div>
                </div>
            </div>
            <div id="resultsContainer"></div>
        </section>
    </div>

    <script src="/static/js/api.js"></script>
    <script src="/static/js/components.js"></script>
    <script src="/static/js/app.js"></script>
    <script>
        // 折叠面板
        function toggleSection(id) {
            const body = document.getElementById(id);
            const iconId = id.replace('Body', 'Icon');
            const icon = document.getElementById(iconId);
            body.classList.toggle('open');
            if (icon) icon.classList.toggle('open');
        }

        // 密码可见性
        function toggleKeyVisibility() {
            const input = document.getElementById('apiKey');
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        // 初始化
        App.init('hallucination');
    </script>
</body>
</html>

