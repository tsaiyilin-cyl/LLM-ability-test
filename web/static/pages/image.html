<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡åˆ†ç±»æµ‹è¯• - LLM èƒ½åŠ›æµ‹è¯•å¹³å°</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ–¼ï¸ å›¾ç‰‡åˆ†ç±»æµ‹è¯•</h1>
            <p>æµ‹è¯•æ¨¡å‹çš„è§†è§‰ç†è§£ä¸åˆ†ç±»èƒ½åŠ›</p>
            <a href="/static/index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
        </header>

        <!-- API é…ç½® -->
        <section class="card">
            <div class="collapsible-header" onclick="toggleSection('configBody')">
                <h3>âš™ï¸ API é…ç½®</h3>
                <span class="toggle-icon" id="configIcon">â–¼</span>
            </div>
            <div class="collapsible-body" id="configBody">
                <div class="form-grid">
                    <div class="form-field">
                        <label>API Base URL</label>
                        <input type="text" id="apiBaseUrl" placeholder="https://api.openai.com">
                    </div>
                    <div class="form-field">
                        <label>API Key</label>
                        <div class="input-with-toggle">
                            <input type="password" id="apiKey" placeholder="sk-xxxxxxxx">
                            <button class="toggle-visibility" onclick="toggleKeyVisibility()">ğŸ‘ï¸</button>
                        </div>
                    </div>
                </div>
                <div class="btn-group mt-2">
                    <button class="btn btn-primary btn-sm" onclick="saveConfig()">ğŸ’¾ ä¿å­˜</button>
                    <button class="btn btn-secondary btn-sm" onclick="testConnection()">ğŸ”— æµ‹è¯•è¿æ¥</button>
                    <button class="btn btn-secondary btn-sm" id="fetchModelsBtn" onclick="fetchModelsFromAPI()">ğŸ”„ è·å–æ¨¡å‹åˆ—è¡¨</button>
                </div>
                <div class="status info mt-1" id="apiStatus">âšª ç‚¹å‡»æµ‹è¯•è¿æ¥</div>
            </div>
        </section>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="form-grid">
            <div class="card">
                <div class="collapsible-header" onclick="toggleSection('modelBody')">
                    <div>
                        <h3>ğŸ¤– é€‰æ‹©æ¨¡å‹</h3>
                        <span class="model-display" id="modelDisplay">æœªé€‰æ‹©</span>
                    </div>
                    <span class="toggle-icon" id="modelIcon">â–¼</span>
                </div>
                <div class="collapsible-body open" id="modelBody">
                    <div class="model-selector">
                        <input type="text" id="modelSearchInput" class="model-search-input" placeholder="ğŸ” æœç´¢æ¨¡å‹...">
                        <select id="modelSelect" size="8" class="model-select">
                            <!-- æ¨¡å‹åˆ—è¡¨å°†é€šè¿‡ JavaScript åŠ¨æ€åŠ è½½ -->
                        </select>
                        <span class="hint">
                            è¯·åœ¨ API é…ç½®ä¸­ç‚¹å‡»"è·å–æ¨¡å‹åˆ—è¡¨"æŒ‰é’®è·å–æ¨¡å‹ï¼Œç„¶ååœ¨æœç´¢æ¡†ä¸­è¾“å…¥å…³é”®è¯å¿«é€ŸæŸ¥æ‰¾
                        </span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="mb-1">æµ‹è¯•è¯­è¨€</h3>
                <select id="langSelect" onchange="updatePromptsForLanguage()">
                    <option value="zh">ä¸­æ–‡</option>
                    <option value="en">English</option>
                </select>
            </div>
        </div>

        <!-- æç¤ºè¯é…ç½® -->
        <section class="card">
            <div class="collapsible-header" onclick="toggleSection('promptBody')">
                <h3>ğŸ“ æç¤ºè¯é…ç½®</h3>
                <span class="toggle-icon" id="promptIcon">â–¼</span>
            </div>
            <div class="collapsible-body open" id="promptBody">
                <div class="form-grid">
                    <div class="form-field">
                        <label>System Prompt <span class="label-hint">(ç³»ç»Ÿæç¤ºè¯)</span></label>
                        <textarea id="sysPrompt"></textarea>
                        <span class="hint">å®šä¹‰ AI åŠ©æ‰‹çš„è§’è‰²å’Œè¡Œä¸º</span>
                    </div>
                    <div class="form-field">
                        <label>User Prompt <span class="label-hint">(ç”¨æˆ·æç¤ºè¯æ¨¡æ¿)</span></label>
                        <textarea id="userPrompt"></textarea>
                        <span class="hint">è¯†åˆ«å›¾ç‰‡å†…å®¹æ—¶ä½¿ç”¨çš„æç¤ºè¯</span>
                    </div>
                </div>
                <div class="btn-group mt-2">
                    <button class="btn btn-secondary btn-sm" onclick="resetPrompts()">ğŸ”„ é‡ç½®ä¸ºé»˜è®¤</button>
                    <button class="btn btn-secondary btn-sm" onclick="savePrompts()">ğŸ’¾ ä¿å­˜æç¤ºè¯</button>
                </div>
            </div>
        </section>

        <!-- å›¾ç‰‡ä¸Šä¼  -->
        <section class="card">
            <h3 class="mb-1">ğŸ“¤ ä¸Šä¼ æµ‹è¯•å›¾ç‰‡</h3>
            <div class="image-upload-zone" id="uploadZone" onclick="document.getElementById('imageInput').click()">
                <input type="file" id="imageInput" accept="image/*" class="hidden-input" onchange="handleImageUpload(event)">
                <p class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ä¸Šä¼ </p>
                <p class="upload-text-small">æ”¯æŒ JPG, PNG, GIF, WebP</p>
            </div>
            <img id="imagePreview" class="image-preview hidden">
            <div class="btn-group mt-2">
                <button class="btn btn-primary" id="classifyBtn" onclick="classifyImage()" disabled>ğŸ” å¼€å§‹åˆ†ç±»</button>
                <button class="btn btn-secondary" onclick="clearImage()">ğŸ—‘ï¸ æ¸…é™¤å›¾ç‰‡</button>
            </div>
        </section>

        <!-- é¢„è®¾æµ‹è¯•å›¾ç‰‡ -->
        <section class="card">
            <h3 class="mb-1">ğŸ–¼ï¸ é¢„è®¾æµ‹è¯•å›¾ç‰‡</h3>
            <p class="preset-hint">ç‚¹å‡»å›¾ç‰‡è¿›è¡Œåˆ†ç±»æµ‹è¯•</p>
            <div class="test-grid" id="imageGrid">
                <!-- å›¾ç‰‡åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ è½½ -->
            </div>
        </section>

        <!-- æµ‹è¯•ç»“æœ -->
        <section class="card hidden" id="resultsSection">
            <div class="card-header">
                <h3>ğŸ“Š åˆ†ç±»ç»“æœ</h3>
                <button class="btn btn-secondary btn-sm" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
            </div>
            <div id="resultsContainer"></div>
        </section>
    </div>

    <script src="/static/js/api.js"></script>
    <script src="/static/js/components.js"></script>
    <script>
        let currentImage = null;
        let testResults = [];

        // é»˜è®¤æç¤ºè¯ (ä¸­è‹±æ–‡)
        const defaultPrompts = {
            zh: {
                sys: "ä½ æ˜¯ä¸€ä¸ªå‡ºè‰²çš„å›¾ç‰‡åˆ†ç±»åŠ©æ‰‹ï¼Œå¯¹äºç”¨æˆ·è¾“å…¥çš„ä¸€å¼ å›¾ç‰‡ï¼Œå¯ä»¥è¯†åˆ«å›¾ç‰‡ä¸­çš„ä¸»ä½“ï¼Œå¹¶ä¸”è¾“å‡ºæ­£ç¡®çš„ç±»åˆ«ã€‚",
                user: "è¯†åˆ«å›¾ç‰‡ä¸­çš„å†…å®¹ï¼Œå†å›ç­”æ­£ç¡®åˆ†ç±»ä¹‹å‰å…ˆè¾“å‡ºç†ç”±ã€‚è¾“å‡ºæ ¼å¼ä¸ºï¼š\n1.reasoning\n{{æ¨ç†å†…å®¹}}\n2.answer\n{{ç±»åˆ«å}}"
            },
            en: {
                sys: "You are an excellent image classification assistant. For an image input by the user, you can identify the subject in the image and output the correct category.",
                user: "Identify the content in the image. Before answering the correct classification, output the reasoning. Format:\n1.reasoning\n{{reasoning}}\n2.answer\n{{category}}"
            }
        };

        // æŠ˜å é¢æ¿
        function toggleSection(id) {
            const body = document.getElementById(id);
            const iconId = id.replace('Body', 'Icon');
            const icon = document.getElementById(iconId);
            
            body.classList.toggle('open');
            
            // æ›´æ–°å›¾æ ‡æ—‹è½¬çŠ¶æ€
            if (icon) {
                icon.classList.toggle('open');
            }
        }

        // å¯†ç å¯è§æ€§
        function toggleKeyVisibility() {
            const input = document.getElementById('apiKey');
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        // ä¿å­˜é…ç½®
        function saveConfig() {
            const config = API.getConfig();
            API.saveConfig(config);
            document.getElementById('apiStatus').className = 'status success mt-1';
            document.getElementById('apiStatus').textContent = 'âœ… é…ç½®å·²ä¿å­˜';
        }

        // æµ‹è¯•è¿æ¥
        async function testConnection() {
            const status = document.getElementById('apiStatus');
            status.className = 'status info mt-1';
            status.textContent = 'ğŸ”„ æ­£åœ¨æµ‹è¯•...';
            
            try {
                // è·å–é€‰ä¸­çš„æ¨¡å‹
                const modelSelect = document.getElementById('modelSelect');
                const model = modelSelect?.value || 'o3';
                const result = await API.testConnection(model);
                if (result.success) {
                    status.className = 'status success mt-1';
                    status.textContent = 'âœ… è¿æ¥æˆåŠŸï¼';
                } else {
                    status.className = 'status error mt-1';
                    status.textContent = 'âŒ ' + result.error;
                }
            } catch (e) {
                status.className = 'status error mt-1';
                status.textContent = 'âŒ ' + e.message;
            }
        }

        // æ›´æ–°æç¤ºè¯ï¼ˆæ ¹æ®è¯­è¨€ï¼‰
        function updatePromptsForLanguage() {
            const lang = document.getElementById('langSelect').value;
            const saved = localStorage.getItem(`llm_prompts_image_${lang}`);
            
            if (saved) {
                const prompts = JSON.parse(saved);
                document.getElementById('sysPrompt').value = prompts.sys_prompt || '';
                document.getElementById('userPrompt').value = prompts.user_prompt || '';
            } else {
                const defaults = defaultPrompts[lang];
                document.getElementById('sysPrompt').value = defaults.sys;
                document.getElementById('userPrompt').value = defaults.user;
            }
        }

        // ä¿å­˜æç¤ºè¯
        function savePrompts() {
            const lang = document.getElementById('langSelect').value;
            const prompts = {
                sys_prompt: document.getElementById('sysPrompt').value,
                user_prompt: document.getElementById('userPrompt').value
            };
            localStorage.setItem(`llm_prompts_image_${lang}`, JSON.stringify(prompts));
            Components.toast('âœ… æç¤ºè¯å·²ä¿å­˜ï¼');
        }

        // é‡ç½®æç¤ºè¯
        function resetPrompts() {
            const lang = document.getElementById('langSelect').value;
            const defaults = defaultPrompts[lang];
            document.getElementById('sysPrompt').value = defaults.sys;
            document.getElementById('userPrompt').value = defaults.user;
            localStorage.removeItem(`llm_prompts_image_${lang}`);
            Components.toast('ğŸ”„ å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯');
        }

        // å›¾ç‰‡ä¸Šä¼ 
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentImage = e.target.result;
                    document.getElementById('imagePreview').src = currentImage;
                    document.getElementById('imagePreview').classList.remove('hidden');
                    document.getElementById('classifyBtn').disabled = false;
                };
                reader.readAsDataURL(file);
            }
        }

        // æ‹–æ‹½ä¸Šä¼ 
        const uploadZone = document.getElementById('uploadZone');
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(ev) {
                    currentImage = ev.target.result;
                    document.getElementById('imagePreview').src = currentImage;
                    document.getElementById('imagePreview').classList.remove('hidden');
                    document.getElementById('classifyBtn').disabled = false;
                };
                reader.readAsDataURL(file);
            }
        });

        // æ¸…é™¤å›¾ç‰‡
        function clearImage() {
            currentImage = null;
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('imageInput').value = '';
            document.getElementById('classifyBtn').disabled = true;
        }

        // åˆ†ç±»å›¾ç‰‡
        async function classifyImage() {
            if (!currentImage) return;
            
            const btn = document.getElementById('classifyBtn');
            btn.disabled = true;
            btn.textContent = 'â³ åˆ†ç±»ä¸­...';
            
            const resultsSection = document.getElementById('resultsSection');
            resultsSection.classList.remove('hidden');
            const container = document.getElementById('resultsContainer');
            
            const lang = document.getElementById('langSelect').value;
            const loading = Components.createLoading('classify', lang === 'zh' ? 'æ­£åœ¨åˆ†æå›¾ç‰‡...' : 'Analyzing image...');
            container.insertBefore(loading, container.firstChild);
            
            try {
                const prompts = {
                    sys_prompt: document.getElementById('sysPrompt').value,
                    user_prompt: document.getElementById('userPrompt').value
                };
                // è·å–é€‰ä¸­çš„æ¨¡å‹
                const modelSelect = document.getElementById('modelSelect');
                const model = modelSelect?.value || 'o3';
                
                const result = await API.classifyImage(currentImage, model, prompts);
                
                document.getElementById('loading-classify')?.remove();
                
                if (result.success) {
                    const card = document.createElement('div');
                    card.className = 'result-card';
                    card.innerHTML = `
                        <div class="result-meta">
                            <span>ğŸ¤– ${result.model}</span>
                            <span class="badge">${lang === 'zh' ? 'ä¸­æ–‡' : 'English'}</span>
                            <span class="time">â±ï¸ ${result.response_time}s</span>
                        </div>
                        <div class="mb-2">
                            <img src="${currentImage}" class="result-image">
                        </div>
                        <div class="result-answer">
                            <h4>${lang === 'zh' ? 'åˆ†ç±»ç»“æœ' : 'Classification Result'}</h4>
                            <pre>${result.answer}</pre>
                        </div>
                    `;
                    container.insertBefore(card, container.firstChild);
                } else {
                    const errorCard = Components.createErrorCard('classify', result.error);
                    container.insertBefore(errorCard, container.firstChild);
                }
            } catch (e) {
                document.getElementById('loading-classify')?.remove();
                const errorCard = Components.createErrorCard('classify', e.message);
                container.insertBefore(errorCard, container.firstChild);
            }
            
            btn.disabled = false;
            btn.textContent = 'ğŸ” å¼€å§‹åˆ†ç±»';
        }

        // æ¸…ç©ºç»“æœ
        function clearResults() {
            testResults = [];
            document.getElementById('resultsContainer').innerHTML = '';
        }

        // åŠ è½½é¢„è®¾å›¾ç‰‡
        function loadPresetImages() {
            const images = [
                { id: '1', name: 'hot_pink', path: '../../data/2å›¾ç‰‡åˆ†ç±»/data/1-hot_pink.jpg' },
                { id: '10', name: 'ç®±é¾Ÿ', path: '../../data/2å›¾ç‰‡åˆ†ç±»/data/10-ç®±é¾Ÿ.jpg' },
                { id: '13', name: 'è€ƒæ‹‰', path: '../../data/2å›¾ç‰‡åˆ†ç±»/data/13-è€ƒæ‹‰1.jpg' },
                { id: '17', name: 'é‡‘æ¯›å¯»å›çŠ¬', path: '../../data/2å›¾ç‰‡åˆ†ç±»/data/17-é‡‘æ¯›å¯»å›çŠ¬_ç®€å•.jpg' }
            ];
            
            const grid = document.getElementById('imageGrid');
            grid.innerHTML = '<p class="text-muted">é¢„è®¾å›¾ç‰‡åŠŸèƒ½å¼€å‘ä¸­...</p>';
        }

        // åŠ è½½é…ç½®
        function loadConfig() {
            const config = API.loadConfig();
            if (config) {
                document.getElementById('apiBaseUrl').value = config.base_url || '';
                document.getElementById('apiKey').value = config.api_key || '';
            }
        }

        // ä» API è·å–æ¨¡å‹åˆ—è¡¨
        async function fetchModelsFromAPI() {
            const config = API.getConfig();
            if (!config.base_url || !config.api_key) {
                Components.toast('âŒ è¯·å…ˆé…ç½® API Base URL å’Œ API Key', 'error');
                return;
            }
            
            const btn = document.getElementById('fetchModelsBtn');
            const originalText = btn?.textContent;
            
            if (btn) {
                btn.disabled = true;
                btn.textContent = 'â³ è·å–ä¸­...';
            }
            
            try {
                const models = await API.fetchModelsFromAPI();
                
                if (models.length === 0) {
                    Components.toast('âš ï¸ API è¿”å›äº†ç©ºæ¨¡å‹åˆ—è¡¨', 'warning');
                    return;
                }
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('llm_fetched_models', JSON.stringify(models));
                
                // é‡æ–°åˆå§‹åŒ–æ¨¡å‹é€‰æ‹©å™¨
                await initModelSelect();
                
                Components.toast(`âœ… æˆåŠŸè·å– ${models.length} ä¸ªæ¨¡å‹`, 'success');
                
            } catch (error) {
                console.error('è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥:', error);
                Components.toast(`âŒ è·å–å¤±è´¥: ${error.message}`, 'error');
            } finally {
                if (btn) {
                    btn.disabled = false;
                    btn.textContent = originalText || 'ğŸ”„ ä» API è·å–æ¨¡å‹';
                }
            }
        }

        // æ›´æ–°æ¨¡å‹æ˜¾ç¤º
        function updateModelDisplay() {
            const modelDisplay = document.getElementById('modelDisplay');
            const modelSelect = document.getElementById('modelSelect');
            
            if (!modelDisplay) return;
            
            let displayText = 'æœªé€‰æ‹©';
            
            if (modelSelect && modelSelect.value) {
                const selectedOption = modelSelect.options[modelSelect.selectedIndex];
                if (selectedOption && !selectedOption.disabled) {
                    displayText = selectedOption.textContent;
                }
            }
            
            modelDisplay.textContent = displayText;
        }

        // è¿‡æ»¤æ¨¡å‹åˆ—è¡¨
        function filterModels(searchTerm) {
            const modelSelect = document.getElementById('modelSelect');
            if (!modelSelect) return;
            
            const searchLower = searchTerm.toLowerCase().trim();
            const allOptions = Array.from(modelSelect.options);
            
            if (!searchTerm) {
                // æ˜¾ç¤ºæ‰€æœ‰é€‰é¡¹
                allOptions.forEach(option => {
                    option.style.display = '';
                });
                return;
            }
            
            // è¿‡æ»¤åŒ¹é…çš„é€‰é¡¹
            allOptions.forEach(option => {
                const text = option.textContent.toLowerCase();
                const value = option.value.toLowerCase();
                
                if (text.includes(searchLower) || value.includes(searchLower)) {
                    option.style.display = '';
                } else {
                    option.style.display = 'none';
                }
            });
        }

        // åˆå§‹åŒ–æ¨¡å‹é€‰æ‹©å™¨
        async function initModelSelect() {
            const modelSelect = document.getElementById('modelSelect');
            const searchInput = document.getElementById('modelSearchInput');
            
            if (!modelSelect) return;
            
            try {
                // æ¸…ç©ºç°æœ‰é€‰é¡¹
                modelSelect.innerHTML = '';
                
                // åªæ·»åŠ ä» API è·å–çš„æ¨¡å‹ï¼ˆå¦‚æœæœ‰ï¼‰
                const fetchedModels = localStorage.getItem('llm_fetched_models');
                if (fetchedModels) {
                    try {
                        const modelsList = JSON.parse(fetchedModels);
                        if (modelsList.length > 0) {
                            modelsList.forEach(model => {
                                const option = document.createElement('option');
                                option.value = model.id;
                                option.textContent = model.name || model.id;
                                option.dataset.fromApi = 'true';
                                modelSelect.appendChild(option);
                            });
                        } else {
                            // å¦‚æœæ²¡æœ‰æ¨¡å‹ï¼Œæ·»åŠ æç¤ºé€‰é¡¹
                            const placeholderOpt = document.createElement('option');
                            placeholderOpt.value = '';
                            placeholderOpt.textContent = 'è¯·å…ˆè·å–æ¨¡å‹åˆ—è¡¨';
                            placeholderOpt.disabled = true;
                            placeholderOpt.selected = true;
                            modelSelect.appendChild(placeholderOpt);
                        }
                    } catch (e) {
                        console.error('è§£æä¿å­˜çš„æ¨¡å‹åˆ—è¡¨å¤±è´¥:', e);
                        // å¦‚æœè§£æå¤±è´¥ï¼Œæ·»åŠ æç¤ºé€‰é¡¹
                        const placeholderOpt = document.createElement('option');
                        placeholderOpt.value = '';
                        placeholderOpt.textContent = 'è¯·å…ˆè·å–æ¨¡å‹åˆ—è¡¨';
                        placeholderOpt.disabled = true;
                        placeholderOpt.selected = true;
                        modelSelect.appendChild(placeholderOpt);
                    }
                } else {
                    // å¦‚æœæ²¡æœ‰ä¿å­˜çš„æ¨¡å‹ï¼Œæ·»åŠ æç¤ºé€‰é¡¹
                    const placeholderOpt = document.createElement('option');
                    placeholderOpt.value = '';
                    placeholderOpt.textContent = 'è¯·å…ˆè·å–æ¨¡å‹åˆ—è¡¨';
                    placeholderOpt.disabled = true;
                    placeholderOpt.selected = true;
                    modelSelect.appendChild(placeholderOpt);
                }
                
                // æ¢å¤ä¿å­˜çš„æ¨¡å‹é€‰æ‹©
                const savedModel = localStorage.getItem('llm_selected_model');
                if (savedModel) {
                    // æ£€æŸ¥ä¿å­˜çš„æ¨¡å‹æ˜¯å¦å­˜åœ¨äºå½“å‰åˆ—è¡¨ä¸­
                    const optionExists = Array.from(modelSelect.options).some(opt => opt.value === savedModel && !opt.disabled);
                    if (optionExists) {
                        modelSelect.value = savedModel;
                    }
                }
                
                // åˆå§‹åŒ–æ˜¾ç¤º
                updateModelDisplay();
                
                // ç›‘å¬æ¨¡å‹é€‰æ‹©å˜åŒ–
                modelSelect.addEventListener('change', () => {
                    localStorage.setItem('llm_selected_model', modelSelect.value);
                    updateModelDisplay();
                });
                
                // ç›‘å¬æœç´¢è¾“å…¥
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        filterModels(e.target.value);
                    });
                    
                    // æŒ‰ ESC é”®æ¸…ç©ºæœç´¢
                    searchInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape') {
                            searchInput.value = '';
                            filterModels('');
                        }
                    });
                }
            } catch (error) {
                console.error('åŠ è½½æ¨¡å‹åˆ—è¡¨å¤±è´¥:', error);
            }
        }
        

        // åˆå§‹åŒ–
        loadConfig();
        loadPresetImages();
        initModelSelect();
        updatePromptsForLanguage(); // åˆå§‹åŒ–æç¤ºè¯
    </script>
</body>
</html>
